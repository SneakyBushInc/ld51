; === Common ===

[Player@Character]
ClassList       = Warrior # Ranger # Paladin # Cleric
NextClass       = @.ClassList
OnPrepare       = "> Object.GetName ^, >> Get < NextClass, > Object.GetName ^, > Config.SetParent < <, Set < Class <,
                   > Object.GetName ^, > Get < ClassList, > Object.GetName ^, Set < NextClass <"

HealDistance    = % >> Get Character Scale, > * < <, * < 1024

Group           = player
Pivot           = bottom truncate

ChildList       = % >> @, > Get < NextClass, > return <Icon, Set < ShaderList <, > @, > Get < NextClass, return <Icon
OnCreate        = "> Object.GetName ^, > @, > Get < Class, Set <Loadout ShaderList <,
                   > @, > Get < Class, > Object.Create <Loadout, > Object.SetParent < ^, > Object.SetOwner < ^,
                   > Object.GetName ^, Set < Loadout <"

-JOY_LX         = MoveLeft
+JOY_LX         = MoveRight
-JOY_LY         = MoveUp
+JOY_LY         = MoveDown

JOY_LEFT        = MoveLeft
JOY_RIGHT       = MoveRight
JOY_UP          = MoveUp
JOY_DOWN        = MoveDown

-JOY_RX         = AimLeft
+JOY_RX         = AimRight
-JOY_RY         = AimUp
+JOY_RY         = AimDown

JOY_A           = Action1
JOY_X           = Action2
JOY_B           = Revive
JOY_Y           = Roulette

JOY_RTRIGGER    = Action1
JOY_LTRIGGER    = Action2
JOY_RBUMPER     = Revive
JOY_LBUMPER     = Roulette

ShaderList      = @
ParamList       = HueShift # texture
Code            = "
vec3 rgb2hsl(vec3 c)
{
  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
  vec4 p = c.g < c.b ? vec4(c.bg, K.ab) : vec4(c.gb, K.rg);
  vec4 q = c.r < p.r ? vec4(p.rga, c.r) : vec4(c.r, p.gbr);
  float col = q.r - min(q.a, q.g);
  vec3 hcv = vec3(abs((q.a - q.g) / (6.0 * col + 1e-10) + q.b), col, q.r);
  float L = hcv.b - hcv.g * 0.5;
  return vec3(hcv.r, min(hcv.g / (1.0 - abs(L * 2.0 - 1.0) + 1e-10), 1.0), L);
}

vec3 hsl2rgb(vec3 c)
{
  vec3 rgb = clamp(vec3(abs(c.r * 6.0 - 3.0) - 1.0, 2.0 - abs(c.r * 6.0 - 2.0), 2.0 - abs(c.r * 6.0 - 4.0)), vec3(0.0), vec3(1.0));
  return (rgb - vec3(0.5)) * vec3((1.0 - abs(2.0 * c.z - 1.0)) * c.y) + c.b;
}

void main()
{
  vec4 color    = texture2D(texture, gl_TexCoord[0].xy);
  vec3 hsl      = rgb2hsl(color.rgb);
  hsl.x         = mod(hsl.x + HueShift, 1.0);
  vec3 rgb      = hsl2rgb(hsl);
  gl_FragColor  = vec4(rgb, color.a);
}
"

[Icon]
Group           = ui
Graphic         = @
Text            = @
Position        = bottom -> top (0, 6)

[Loadout@Object]
Group           = player
Scale           = @Character
IgnoreFromParent= scale
AnimationSet    = @
Position        = (0, -4, -0.01)
Pivot           = (16, 28)
Prefix          = @
KeyDuration     = @Character
FrameSize       = @Character
TextureSize     = @Character
StartAnim       = @Character
Idle            = @Character
Death           = @Character
Dead            = @Character
Revive          = @Character
Action2         = 2
Idle->          = Idle # .Run # .!Death # .!Action1 # .!Action2
Run->           = @Character
Death->         = @Character
Dead->          = @Character
Revive->        = @Character
Action1->       = Idle
Action2->       = Idle

[Action1]
TextureOrigin   = (0, 96)

[Action2]
TextureOrigin   = (0, 128)


; === Classes ===

[Warrior@Player]
Texture         = player/warrior.png

[WarriorLoadout@Loadout]
Texture         = player/warrior-weapon.png

[WarriorWeapon@Weapon]
Size            = (20, 32)
Pivot           = (0, 24)
Damage          = 100

[WarriorLoadoutAction11]
KeyEvent        = > Object.Create WarriorWeapon, > Object.SetParent < ^, > Object.Detach <, Object.SetLifeTime < 0.5

[WarriorIcon@Icon]
String          = âš”

[Ranger@Player]
Texture         = player/ranger.png

[RangerLoadout@Loadout]
Texture         = player/ranger-weapon.png
Action2         = -1

[RangerIcon@Icon]
String          = ðŸ”«

[Paladin@Player]
Texture         = player/paladin.png

[PaladinLoadout@Loadout]
Texture         = player/paladin-weapon.png
Position        = (0, -6, -0.01)
Pivot           = (16, 26)

[PaladinIcon@Icon]
String          = ðŸ›¡

[Cleric@Player]
Texture         = player/cleric.png

[ClericLoadout@Loadout]
Texture         = player/cleric-weapon.png

[ClericIcon@Icon]
String          = â™¥


; === Player 1 ===

[Player1@Player]

Position        = (-100, -100)
HueShift        = 0

JoyIDList       = 1
KEY_W           = MoveUp
KEY_A           = MoveLeft
KEY_S           = MoveDown
KEY_D           = MoveRight

MOUSE_LEFT      = Action1
MOUSE_RIGHT     = Action2

MOUSE_EXTRA_1   = Revive
KEY_SPACE       = Revive
KEY_RCTRL       = Revive

MOUSE_MIDDLE    = Roulette
KEY_F           = Roulette
KEY_NUMPAD0     = Roulette


; === Player 2 ===

[Player2@Player]
Position        = (100, -100)
HueShift        = 0.35

JoyIDList       = 2
KEY_UP          = MoveUp
KEY_LEFT        = MoveLeft
KEY_DOWN        = MoveDown
KEY_RIGHT       = MoveRight


; === Player 3 ===

[Player3@Player]
Position        = (-100, 100)
HueShift        = 0.57

JoyIDList       = 3

; === Player 4 ===

[Player4@Player]
Position        = (100, 100)
HueShift        = 0.7

JoyIDList       = 4
